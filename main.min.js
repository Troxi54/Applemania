!function(){"use strict";let e=e=>new Decimal(e);function t(e){return document.querySelector(e)}function s(t,a=2){if(!t&&0!==t)return;if(t instanceof Decimal&&!t.toNumber()&&0!==t.toNumber())return;t instanceof Decimal==!1&&(t=e(t));const l=["","k","M","B","T","Qd","Qn","Sx","Sp","Oc","No","Dc","Ud","Dd","Td","Qad","Qid","Sxd","Spd","Ocd","Nd","Vg","Uvg","Dvg","Tvg","Qavg","Qivg","Sxvg","Spvg","Ocvg","Nvg","Tg"];if(t.eq("0"))return"0";if(t.lt("1e3"))return t.toNumber().toFixed(a);if(t.lt("1e6"))return t.toNumber().toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g,",");if(t.lt(e(1e3).pow(l.length))){const e=t.log(1e3).abs().floor(),s=t.div(Decimal.pow(1e3,e));return s.toFixed(3-+s.log(10).floor())+l[e.toNumber()]}if(t.lt("ee6")){let a=t.log10();return a=a.plus(a.div(1e9)).floor(),t.div(e(10).pow(a)).toNumber().toFixed(2)+"e"+s(a,0)}return"e"+s(t.log10(),a)}Decimal.prototype.softcap=function(e,t,s,a=!1){var l=this;return!a&&l.gte(e)&&([0,"pow"].includes(s)&&(l=l.div(e).max(1).pow(t).mul(e)),[1,"mul"].includes(s)&&(l=l.sub(e).div(t).add(e)),[2,"exp"].includes(s)&&(l=expPow(l.div(e),t).mul(e)),[3,"log"].includes(s)&&(l=l.div(e).log(t).add(1).mul(e))),l},Element.prototype.hide=function(){this.style.display="none"},Element.prototype.show=function(){this.style.display=""};const a=60;let l={apples:e(0),totalApples:e(0),appleGain:e(1),speed:4,size:1,appleArray:[],applesOnField:0,appleSpawningRate:.5,applesMax:4e3,level:e(0),levelRequirement:e(25),tier:e(0),upgrades:{au1:{cost:(t=l.upgrades.au1.lvl)=>e(10).times(e(5).pow(t)),bulk:()=>l.apples.div(10).log(5).minus(l.upgrades.au1.lvl).max(0).plus(1).floor(),condition:()=>l.apples.gte(l.upgrades.au1.cost()),effect:(t=l.upgrades.au1.lvl)=>e(1.225).pow(t),lvl:e(0)},au2:{cost:(t=l.upgrades.au2.lvl)=>e(20).times(e(5).pow(t)),bulk:()=>l.apples.div(20).log(5).minus(l.upgrades.au2.lvl).max(0).plus(1).floor(),condition:()=>l.apples.gte(l.upgrades.au2.cost()),effect:(t=l.upgrades.au2.lvl)=>e(1.16).pow(t),lvl:e(0)},au3:{cost:(t=l.upgrades.au3.lvl)=>e(30).times(e(2).pow(t)),bulk:()=>l.apples.div(30).log(2).minus(l.upgrades.au3.lvl).max(0).plus(1).floor(),condition:()=>l.apples.gte(l.upgrades.au3.cost()),effect:(t=l.upgrades.au3.lvl)=>e(1.25).pow(t),lvl:e(0)},au4:{cost:(t=l.upgrades.au4.lvl)=>e(40).times(e(1.275).pow(t)),bulk:()=>l.apples.div(40).log(1.275).minus(l.upgrades.au4.lvl).max(0).plus(1).floor(),condition:()=>l.apples.gte(l.upgrades.au4.cost()),effect:(t=l.upgrades.au4.lvl)=>e(1.1).pow(t),lvl:e(0)},au5:{cost:(t=l.upgrades.au5.lvl)=>e("1e4").times(e(10).pow(t)),bulk:()=>l.apples.div("1e4").log(10).minus(l.upgrades.au5.lvl).max(0).plus(1).floor(),condition:()=>l.apples.gte(l.upgrades.au5.cost()),effect:(t=l.upgrades.au5.lvl)=>e(1.5).pow(t),lvl:e(0)}},firstVisit:Date.now(),keyPressed:{}},p={update(e,t){e.innerHTML!==t&&(e.innerHTML=t)},at(){this.update(t("#at"),`You have <span class="apple">${s(l.apples,0)}</span> apples`)},ait(){this.update(t("#ait"),`${s(l.appleArray.length,0)}/${s(l.applesRealMax,0)} (+${s(l.appleSpawningRate,2)}/sec)`)},lp(){this.update(t("#lp"),`Level: <span class="level">${s(l.level,0)}</span> (<span class="apple">${s(l.totalApples,0)}</span>/<span class="apple">${s(l.levelRequirement,0)}</span> total apples)`+(l.level.gte(1)?`<br><span class="italic"><span class="apple">x${s(l.levelEffect)}</span> apples</span>`:""))},au1(){this.update(t("#au1i"),`<h3>Level ${s(l.upgrades.au1.lvl,0)}</h3>Increase player size by <h3>x${s(l.upgrades.au1.effect(1))}</h3><br>${s(l.upgrades.au1.cost(),0)} apples`)},au2(){this.update(t("#au2i"),`<h3>Level ${s(l.upgrades.au2.lvl,0)}</h3>Increase player speed by <h3>x${s(l.upgrades.au2.effect(1))}</h3><br>${s(l.upgrades.au2.cost(),0)} apples`)},au3(){this.update(t("#au3i"),`<h3>Level ${s(l.upgrades.au3.lvl,0)}</h3>Increase apple cap by <h3>x${s(l.upgrades.au3.effect(1))}</h3><br>${s(l.upgrades.au3.cost(),0)} apples`)},au4(){this.update(t("#au4i"),`<h3>Level ${s(l.upgrades.au4.lvl,0)}</h3>Increase apple grow speed by <h3>x${s(l.upgrades.au4.effect(1))}</h3><br>${s(l.upgrades.au4.cost(),0)} apples`)},au5(){this.update(t("#au5i"),`<h3>Level ${s(l.upgrades.au5.lvl,0)}</h3>Increase apple gain by <h3>x${s(l.upgrades.au5.effect(1))}</h3><br>${s(l.upgrades.au5.cost(),0)} apples`)},tp(){this.update(t("#tp"),l.tier.gt(0)?`<span class="tp">Tier: <span class="tier">${s(l.tier,0)}</span></span> (<span class="size">${s(l.size,0)}</span>/<span class="size">${s(l.tierRequirement,0)}</span> size)<br><span class="italic"><span class="apple">x${s(l.tierEffect)}</span> apples</span>`+(l.tierEffect2.gt(1)?` and <span class="speed">x${s(l.tierEffect2)}</span> player speed`:""):"")},updateAll(){for(let e in this)["updateAll","update"].includes(e)||this[e]()}},n={drawApples(){const e=t("#aac"),s=l.appleArray;e.width=e.getBoundingClientRect().width,e.height=e.getBoundingClientRect().height;const a=e.getContext("2d"),p=e.getBoundingClientRect().width;for(let n=0;n<l.appleArray.length;n++){const i=s[n].size;a.fillStyle=s[n].color;let[u,r]=[s[n].x*(p-i),s[n].y*(p-i)];const d=t("#p").getBoundingClientRect(),o=e.getBoundingClientRect().x+u,c=e.getBoundingClientRect().y+r;d.x+d.width>o&&d.x<o+s[n].size&&d.y+d.height>c&&d.y<c+s[n].size?(this.getApple(n),l.appleArray.splice(n,1),l.applesOnField--,n--):a.fillRect(u,r,i,i)}},spawnApple(){l.appleArray.length<l.applesRealMax&&l.appleArray.push({x:Math.random(),y:Math.random(),color:"#ff0000",size:10})},spawnApples(e){e=Math.min(e,l.applesRealMax-l.appleArray.length);for(let t=0;t<e;t++)this.spawnApple()},getApple(e){l.appleArray[e]&&(l.apples=l.apples.plus(l.appleGain),l.totalApples=l.totalApples.plus(l.appleGain),l.totalApples.lt(l.apples)&&(l.totalApples=l.apples))},preventLeavingArea(e){let s=t("#aa").getBoundingClientRect(),a=e.getBoundingClientRect().width,l=Number(getComputedStyle(e).marginLeft.slice(0,-2))||0,p=Number(getComputedStyle(e).marginTop.slice(0,-2))||0,n=getComputedStyle(t("#aa")).borderWidth.slice(0,-2);l>s.width-a-2*n?e.style.marginLeft=s.width-a-2*n+"px":l<-s.width+a+2*n&&(e.style.marginLeft=-s.width+a+2*n+"px"),p>s.width-a-2*n?e.style.marginTop=s.width-a-2*n+"px":p<-s.width+a+2*n&&(e.style.marginTop=-s.width+a+2*n+"px")}};function i(){if(l.levelRequirement=e(25).times(e(3.85).pow(l.level)).floor(),l.totalApples.gte(l.levelRequirement)){const e=l.totalApples.div(25).log(3.85).minus(l.level).max(0).plus(1).floor();l.level=l.level.plus(e)}l.level.gte(7)?t("#au5").show():t("#au5").hide(),l.size=e(1).times(l.upgrades.au1.effect()),l.tierRequirement=e(49).pow(l.tier.plus(1)),l.size.gte(l.tierRequirement)&&(l.tier=l.tier.plus(1),l.appleArray=[],l.applesOnField=0),l.tierEffect=e("1e5").pow(l.tier.softcap(2,.7,"pow")),l.tierEffect2=e("3.2").pow(l.tier.minus(2).max(0)),l.speed=e(4).times(l.upgrades.au2.effect()).times(l.tierEffect2),l.applesMax=l.upgrades.au3.effect().times(3).floor(),l.applesRealMax=+l.applesMax.div(e(1e4).pow(l.tier)).min(5e3).floor().max(1),l.appleSpawningRate=e(.5).times(l.upgrades.au4.effect()).div(e("e5").pow(l.tier)),l.levelEffect=e(2).pow(l.level),l.appleGain=l.tierEffect.times(l.levelEffect).times(l.upgrades.au5.effect()),t("#p").style.setProperty("--size",l.size.div(e(49).pow(l.tier))+"px");const s=Number(getComputedStyle(t("#p")).marginLeft.slice(0,-2))||0,i=Number(getComputedStyle(t("#p")).marginTop.slice(0,-2))||0,u=+l.speed.div(e(49).pow(l.tier).div(l.tier.gt(0)?4:1));(l.keyPressed.ArrowLeft||l.keyPressed.KeyA||l.keyPressed.ml)&&(t("#p").style.marginLeft=s-u+"px"),(l.keyPressed.ArrowRight||l.keyPressed.KeyD||l.keyPressed.mr)&&(t("#p").style.marginLeft=s+u+"px"),(l.keyPressed.ArrowUp||l.keyPressed.KeyW||l.keyPressed.mt)&&(t("#p").style.marginTop=i-u+"px"),(l.keyPressed.ArrowDown||l.keyPressed.KeyS||l.keyPressed.mb)&&(t("#p").style.marginTop=i+u+"px"),n.preventLeavingArea(t("#p")),l.applesOnField=e(l.applesOnField),l.applesOnField=l.applesOnField.plus(l.appleSpawningRate.times(1/a)),l.applesOnField.gt(l.applesRealMax)?l.applesOnField=l.applesRealMax:l.applesOnField=+l.applesOnField,n.spawnApples(Math.floor(l.applesOnField)-l.appleArray.length),n.drawApples(),p.updateAll()}function u(){let e={};for(const t in l)e[t]=l[t];for(let t in e)e[t]instanceof Decimal&&(e[t]=e[t].toString());localStorage.setItem("Applemania",btoa(JSON.stringify(e)))}document.addEventListener("DOMContentLoaded",(function(){p.updateAll(),document.addEventListener("keydown",(function(e){l.keyPressed[e.code]=!0})),document.addEventListener("keyup",(function(e){l.keyPressed[e.code]=!1})),t("#au1").addEventListener("click",(function(){let e=l.upgrades.au1;e.condition()&&(l.upgrades.au1.lvl=e.lvl.plus(e.bulk()),l.apples=l.apples.minus(e.cost(l.upgrades.au1.lvl.minus(1))))})),t("#au2").addEventListener("click",(function(){let e=l.upgrades.au2;e.condition()&&(l.upgrades.au2.lvl=e.lvl.plus(e.bulk()),l.apples=l.apples.minus(e.cost(l.upgrades.au2.lvl.minus(1))))})),t("#au3").addEventListener("click",(function(){let e=l.upgrades.au3;e.condition()&&(l.upgrades.au3.lvl=e.lvl.plus(e.bulk()),l.apples=l.apples.minus(e.cost(l.upgrades.au3.lvl.minus(1))))})),t("#au4").addEventListener("click",(function(){let e=l.upgrades.au4;e.condition()&&(l.upgrades.au4.lvl=e.lvl.plus(e.bulk()),l.apples=l.apples.minus(e.cost(l.upgrades.au4.lvl.minus(1))))})),t("#au5").addEventListener("click",(function(){let e=l.upgrades.au5;e.condition()&&(l.upgrades.au5.lvl=e.lvl.plus(e.bulk()),l.apples=l.apples.minus(e.cost(l.upgrades.au5.lvl.minus(1))))})),t("#ml").addEventListener("touchstart",(function(){l.keyPressed.ml=!0})),t("#ml").addEventListener("touchend",(function(){l.keyPressed.ml=!1})),t("#mr").addEventListener("touchstart",(function(){l.keyPressed.mr=!0})),t("#mr").addEventListener("touchend",(function(){l.keyPressed.mr=!1})),t("#mt").addEventListener("touchstart",(function(){l.keyPressed.mt=!0})),t("#mt").addEventListener("touchend",(function(){l.keyPressed.mt=!1})),t("#mb").addEventListener("touchstart",(function(){l.keyPressed.mb=!0})),t("#mb").addEventListener("touchend",(function(){l.keyPressed.mb=!1})),t("#ml").addEventListener("mousedown",(function(){l.keyPressed.ml=!0})),t("#ml").addEventListener("mouseup",(function(){l.keyPressed.ml=!1})),t("#mr").addEventListener("mousedown",(function(){l.keyPressed.mr=!0})),t("#mr").addEventListener("mouseup",(function(){l.keyPressed.mr=!1})),t("#mt").addEventListener("mousedown",(function(){l.keyPressed.mt=!0})),t("#mt").addEventListener("mouseup",(function(){l.keyPressed.mt=!1})),t("#mb").addEventListener("mousedown",(function(){l.keyPressed.mb=!0})),t("#mb").addEventListener("mouseup",(function(){l.keyPressed.mb=!1})),function(t){let s=function(t=localStorage.getItem("Applemania")){let s=!1;try{JSON.parse(t),s=!0}catch{s=!1}s&&(u(),t=btoa(t));if(t){t=JSON.parse(atob(t));for(let s in t)if(t.hasOwnProperty(s)){if("string"==typeof t[s]&&(t[s].includes("e")||/\d/.test(t[s]))){const a=e(t[s]).toNumber();isNaN(a)||null==a||(t[s]=e(t[s]))}if("upgrades"===s){let s=t.upgrades;t.upgrades=l.upgrades;for(let a in t.upgrades)void 0!==s[a]&&(t.upgrades[a].lvl=e(s[a].lvl))}"keyPressed"===s&&(t[s]={})}}return t}(t);if(s)for(let e in s)l[e]=s[e]}(),n.spawnApple(),l.applesOnField=l.appleArray.length,setInterval(u,1e4),setInterval(i,1e3/a)}))}();